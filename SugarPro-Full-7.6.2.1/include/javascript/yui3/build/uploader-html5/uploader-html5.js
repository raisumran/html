/*
     YUI 3.15.0 (build 834026e)
     Copyright 2014 Yahoo! Inc. All rights reserved.
     Licensed under the BSD License.
     http://yuilibrary.com/license/
     */
YUI.add('uploader-html5',function(Y,NAME){var substitute=Y.Lang.sub,UploaderQueue=Y.Uploader.Queue;function UploaderHTML5(){UploaderHTML5.superclass.constructor.apply(this,arguments);}
Y.UploaderHTML5=Y.extend(UploaderHTML5,Y.Widget,{_fileInputField:null,_buttonBinding:null,queue:null,initializer:function(){this._fileInputField=null;this.queue=null;this._buttonBinding=null;this._fileList=[];this.publish("fileselect");this.publish("uploadstart");this.publish("fileuploadstart");this.publish("uploadprogress");this.publish("totaluploadprogress");this.publish("uploadcomplete");this.publish("alluploadscomplete");this.publish("uploaderror");this.publish("dragenter");this.publish("dragover");this.publish("dragleave");this.publish("drop");},renderUI:function(){var contentBox=this.get('contentBox'),selButton=this.get("selectFilesButton");selButton.setStyles({width:"100%",height:"100%"});contentBox.append(selButton);this._fileInputField=Y.Node.create(UploaderHTML5.HTML5FILEFIELD_TEMPLATE);contentBox.append(this._fileInputField);},bindUI:function(){this._bindSelectButton();this._setMultipleFiles();this._setFileFilters();this._bindDropArea();this._triggerEnabled();this.after("multipleFilesChange",this._setMultipleFiles,this);this.after("fileFiltersChange",this._setFileFilters,this);this.after("enabledChange",this._triggerEnabled,this);this.after("selectFilesButtonChange",this._bindSelectButton,this);this.after("dragAndDropAreaChange",this._bindDropArea,this);this.after("tabIndexChange",function(){this.get("selectFilesButton").set("tabIndex",this.get("tabIndex"));},this);this._fileInputField.on("change",this._updateFileList,this);this._fileInputField.on("click",function(event){event.stopPropagation();},this);this.get("selectFilesButton").set("tabIndex",this.get("tabIndex"));},_rebindFileField:function(){this._fileInputField.remove(true);this._fileInputField=Y.Node.create(UploaderHTML5.HTML5FILEFIELD_TEMPLATE);this.get("contentBox").append(this._fileInputField);this._fileInputField.on("change",this._updateFileList,this);this._setMultipleFiles();this._setFileFilters();},_bindDropArea:function(event){var ev=event||{prevVal:null},ddArea=this.get("dragAndDropArea");if(ev.prevVal!==null){ev.prevVal.detach('drop',this._ddEventHandler);ev.prevVal.detach('dragenter',this._ddEventHandler);ev.prevVal.detach('dragover',this._ddEventHandler);ev.prevVal.detach('dragleave',this._ddEventHandler);}
if(ddArea!==null){ddArea.on('drop',this._ddEventHandler,this);ddArea.on('dragenter',this._ddEventHandler,this);ddArea.on('dragover',this._ddEventHandler,this);ddArea.on('dragleave',this._ddEventHandler,this);}},_bindSelectButton:function(){this._buttonBinding=this.get("selectFilesButton").on("click",this.openFileSelectDialog,this);},_ddEventHandler:function(event){event.stopPropagation();event.preventDefault();if(Y.Array.indexOf(event._event.dataTransfer.types,'Files')>-1){switch(event.type){case"dragenter":this.fire("dragenter");break;case"dragover":this.fire("dragover");break;case"dragleave":this.fire("dragleave");break;case"drop":var newfiles=event._event.dataTransfer.files,parsedFiles=[],filterFunc=this.get("fileFilterFunction"),oldfiles;if(filterFunc){Y.each(newfiles,function(value){var newfile=new Y.FileHTML5(value);if(filterFunc(newfile)){parsedFiles.push(newfile);}});}
else{Y.each(newfiles,function(value){parsedFiles.push(new Y.FileHTML5(value));});}
if(parsedFiles.length>0){oldfiles=this.get("fileList");this.set("fileList",this.get("appendNewFiles")?oldfiles.concat(parsedFiles):parsedFiles);this.fire("fileselect",{fileList:parsedFiles});}
this.fire("drop",{fileList:parsedFiles});break;}}},_setButtonClass:function(state,add){if(add){this.get("selectFilesButton").addClass(this.get("buttonClassNames")[state]);}
else{this.get("selectFilesButton").removeClass(this.get("buttonClassNames")[state]);}},_setMultipleFiles:function(){if(this.get("multipleFiles")===true){this._fileInputField.set("multiple","multiple");}
else{this._fileInputField.set("multiple","");}},_setFileFilters:function(){if(this.get("fileFilters").length>0){this._fileInputField.set("accept",this.get("fileFilters").join(","));}
else{this._fileInputField.set("accept","");}},_triggerEnabled:function(){if(this.get("enabled")&&this._buttonBinding===null){this._bindSelectButton();this._setButtonClass("disabled",false);this.get("selectFilesButton").setAttribute("aria-disabled","false");}
else if(!this.get("enabled")&&this._buttonBinding){this._buttonBinding.detach();this._buttonBinding=null;this._setButtonClass("disabled",true);this.get("selectFilesButton").setAttribute("aria-disabled","true");}},_getFileList:function(){return this._fileList.concat();},_setFileList:function(val){this._fileList=val.concat();return this._fileList.concat();},_updateFileList:function(ev){var newfiles=ev.target.getDOMNode().files,parsedFiles=[],filterFunc=this.get("fileFilterFunction"),oldfiles;if(filterFunc){Y.each(newfiles,function(value){var newfile=new Y.FileHTML5(value);if(filterFunc(newfile)){parsedFiles.push(newfile);}});}
else{Y.each(newfiles,function(value){parsedFiles.push(new Y.FileHTML5(value));});}
if(parsedFiles.length>0){oldfiles=this.get("fileList");this.set("fileList",this.get("appendNewFiles")?oldfiles.concat(parsedFiles):parsedFiles);this.fire("fileselect",{fileList:parsedFiles});}
this._rebindFileField();},_uploadEventHandler:function(event){switch(event.type){case"file:uploadstart":this.fire("fileuploadstart",event);break;case"file:uploadprogress":this.fire("uploadprogress",event);break;case"uploaderqueue:totaluploadprogress":this.fire("totaluploadprogress",event);break;case"file:uploadcomplete":this.fire("uploadcomplete",event);break;case"uploaderqueue:alluploadscomplete":this.queue=null;this.fire("alluploadscomplete",event);break;case"file:uploaderror":case"uploaderqueue:uploaderror":this.fire("uploaderror",event);break;case"file:uploadcancel":case"uploaderqueue:uploadcancel":this.fire("uploadcancel",event);break;}},openFileSelectDialog:function(){var fileDomNode=this._fileInputField.getDOMNode();if(fileDomNode.click){fileDomNode.click();}},upload:function(file,url,postvars){var uploadURL=url||this.get("uploadURL"),postVars=postvars||this.get("postVarsPerFile"),fileId=file.get("id");postVars=postVars.hasOwnProperty(fileId)?postVars[fileId]:postVars;if(file instanceof Y.FileHTML5){file.on("uploadstart",this._uploadEventHandler,this);file.on("uploadprogress",this._uploadEventHandler,this);file.on("uploadcomplete",this._uploadEventHandler,this);file.on("uploaderror",this._uploadEventHandler,this);file.on("uploadcancel",this._uploadEventHandler,this);file.startUpload(uploadURL,postVars,this.get("fileFieldName"));}},uploadAll:function(url,postvars){this.uploadThese(this.get("fileList"),url,postvars);},uploadThese:function(files,url,postvars){if(!this.queue){var uploadURL=url||this.get("uploadURL"),postVars=postvars||this.get("postVarsPerFile");this.queue=new UploaderQueue({simUploads:this.get("simLimit"),errorAction:this.get("errorAction"),fileFieldName:this.get("fileFieldName"),fileList:files,uploadURL:uploadURL,perFileParameters:postVars,retryCount:this.get("retryCount"),uploadHeaders:this.get("uploadHeaders"),withCredentials:this.get("withCredentials")});this.queue.on("uploadstart",this._uploadEventHandler,this);this.queue.on("uploadprogress",this._uploadEventHandler,this);this.queue.on("totaluploadprogress",this._uploadEventHandler,this);this.queue.on("uploadcomplete",this._uploadEventHandler,this);this.queue.on("alluploadscomplete",this._uploadEventHandler,this);this.queue.on("uploadcancel",this._uploadEventHandler,this);this.queue.on("uploaderror",this._uploadEventHandler,this);this.queue.startUpload();this.fire("uploadstart");}
else if(this.queue._currentState===UploaderQueue.UPLOADING){this.queue.set("perFileParameters",this.get("postVarsPerFile"));Y.each(files,function(file){this.queue.addToQueueBottom(file);},this);}}},{HTML5FILEFIELD_TEMPLATE:"<input type='file' style='visibility:hidden; width:0px; height: 0px;'>",SELECT_FILES_BUTTON:'<button type="button" class="yui3-button" role="button" aria-label="{selectButtonLabel}" '+'tabindex="{tabIndex}">{selectButtonLabel}</button>',TYPE:"html5",NAME:"uploader",ATTRS:{appendNewFiles:{value:true},buttonClassNames:{value:{"hover":"yui3-button-hover","active":"yui3-button-active","disabled":"yui3-button-disabled","focus":"yui3-button-selected"}},dragAndDropArea:{value:null,setter:function(val){return Y.one(val);}},enabled:{value:true},errorAction:{value:"continue",validator:function(val){return(val===UploaderQueue.CONTINUE||val===UploaderQueue.STOP||val===UploaderQueue.RESTART_ASAP||val===UploaderQueue.RESTART_AFTER);}},fileFilters:{value:[]},fileFilterFunction:{value:null},fileFieldName:{value:"Filedata"},fileList:{value:[],getter:"_getFileList",setter:"_setFileList"},multipleFiles:{value:false},postVarsPerFile:{value:{}},selectButtonLabel:{value:"Select Files"},selectFilesButton:{valueFn:function(){return Y.Node.create(substitute(Y.UploaderHTML5.SELECT_FILES_BUTTON,{selectButtonLabel:this.get("selectButtonLabel"),tabIndex:this.get("tabIndex")}));}},simLimit:{value:2,validator:function(val){return(val>=1&&val<=5);}},uploadURL:{value:""},uploadHeaders:{value:{}},withCredentials:{value:true},retryCount:{value:3}}});Y.UploaderHTML5.Queue=UploaderQueue;},'3.15.0',{"requires":["widget","node-event-simulate","file-html5","uploader-queue"]});